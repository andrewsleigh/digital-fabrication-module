<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Publishing to multiple servers | Digital Fabrication Module</title>
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="Publishing to multiple servers" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Publishing this content to GitHub, GitHub Pages and my own server." />
<meta property="og:description" content="Publishing this content to GitHub, GitHub Pages and my own server." />
<link rel="canonical" href="http://localhost:4000/colophon/publishing-to-multiple-servers.html" />
<meta property="og:url" content="http://localhost:4000/colophon/publishing-to-multiple-servers.html" />
<meta property="og:site_name" content="Digital Fabrication Module" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-11-24T00:00:00+01:00" />
<script type="application/ld+json">
{"headline":"Publishing to multiple servers","dateModified":"2018-11-24T00:00:00+01:00","datePublished":"2018-11-24T00:00:00+01:00","url":"http://localhost:4000/colophon/publishing-to-multiple-servers.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/colophon/publishing-to-multiple-servers.html"},"description":"Publishing this content to GitHub, GitHub Pages and my own server.","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="alternate" type="application/rss+xml" title="Digital Fabrication Module" href="/feed.xml">
  
  
<!--  OVERRIDE FONTS  -->


<!-- <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Serif+Pro" rel="stylesheet">  <link href="https://fonts.googleapis.com/css?family=Source+Serif+Pro" rel="stylesheet"> -->

<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700|Work+Sans:400,600,700" rel="stylesheet">

<style type="text/css">

body {
	// font-family: 'Source Serif Pro', serif;
	font-family: 'Work Sans', sans-serif;
}

h1, h2 { 
	font-weight: 600; 
	}
	
	
.post-content h3, h3 {
	font-weight: 600; 
	font-size: 1em;
	/* text-transform: uppercase; */
	}	

pre, code {
	font-family: 'Source Code Pro', monospace;
/* 	background-color: #ffe; */

/* Try using alpha transparency instead so it can layr on top of other things */
	background-color: rgba(255, 255, 0, 0.03);
}

pre code {
/* 	Override background colour when inside pre block so transparency is not cumulative */
	background-color: rgba(255, 255, 255, 0);
}

p code {
	/* background-color: #fffffc; */	
	/* Try using alpha transparency instead so it can layr on top of other things */
	background-color: rgba(255, 255, 0, 0.03);

	
	/* border: 1px solid #eec; */
	/* border: 1px solid #eeeecc; */
	border: rgba(90, 90, 0, 0.05) 1px solid;
	/* 
border-top: 1px solid #fff;
	border-left: 1px solid #fff;
 */
	border-top: rgba(255, 255, 255, 0.3) 1px solid;
	border-left: rgba(255, 255, 255, 0.3) 1px solid;
}

.highlighter-rouge pre.highlight,
figure.highlight pre
 {
	background-color: #ffe;
	border: 1px solid #eec;
	border-top: 1px solid #fff;
	border-left: 1px solid #fff;
}

blockquote {
	letter-spacing: 0px;
	border-left: 0px none;
	font-style: normal;
	font-size: 1em;
	background-color: #fff6f9;
	padding: 15px;
	color: #998088;
	}

hr {
	margin: 40px 0px;
	}
	
	
span.wip {
	background-color: rgba(0, 255, 0, 0.3);
	border: rgba(0, 90, 0, 0.3) 1px solid;
	border-top: rgba(255, 255, 255, 0.3) 1px solid;
	border-left: rgba(255, 255, 255, 0.3) 1px solid;
	padding: 0px 4px;
	border-radius: 2px;
	
}	

</style>

  
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <h1><a class="site-title" rel="author" href="/">Digital Fabrication Module</a></h1>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            
            <a class="page-link" href="/category/colophon.html">Colophon</a>
            
            
          
            
            
            
            <a class="page-link" href="/category/course.html">Course Notes</a>
            
            
          
            
            
            
            <a class="page-link" href="/category/diy-arduino.html">DIY Arduino</a>
            
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Publishing to multiple servers</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-11-24T00:00:00+01:00" itemprop="datePublished">Nov 24, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Publishing this content to GitHub, GitHub Pages and my own server.
<!--more--></p>

<p>I use quite a complex system to draft and publish these notes. This is an adaptation of <a href="http://fab.academany.org/2018/labs/fablabbrighton/students/andrew-sleigh/assignments/2018/01/18/wk2-git-and-website.html">a system I first used for my Fab Academy documentation, detailed here</a>. While fiddly to set up, it means I can write notes and share them with minimum friction, and maximum portability.</p>

<h2 id="my-requirements">My requirements</h2>

<ul>
  <li>Quickly take notes on WIP and write rough drafts without having to worry about publishing</li>
  <li>Use basic formatting and images without resorting to a complex word-processor (ie. Markdown)</li>
  <li>Selectively publish/share some of this content</li>
  <li>Easily create a navigable flat HTML website that I can publish to my own domain</li>
  <li>Share some WIP with collaborators on GitHub</li>
  <li>Publish navigable HTML version on GitHub Pages</li>
  <li>Combine drafting and publishing workflows with as few extra steps as possible</li>
</ul>

<p>This is a more complex set of requirements than I used for Fab Academy, where I also used Jekyll to support a Markdown to flat-HTML drafting and publishing workflow. In that case, I was publishing HTML only (not Markdown), and only to one site. The publishing workflow there was simply a case of building the site to my local Git repository, then pushing that to the remote repo. The only complexity was that the URLs for my development server (localhost) and the live server were different. I handled this by using variables in the <code class="highlighter-rouge">_config.yml</code> file, and generating the files for local testing with an override for these live server URLs.</p>

<h2 id="drafting">Drafting</h2>
<p>I’m currently using Bear (a Mac/iOS Markdown editor) for drafting notes) because it has great Markdown support and elegantly hides all the complexity. It has a pretty good Markdown export, the only problem being it hard-codes image links in a way that won’t work for my live sites. I may just switch to writing Markdown directly in a publishable format, using BBEdit (a text-only editor).</p>

<p>Drafting in an app like this introduces a break in the process, which has the downside of introducing a divergence as soon as I export a note to a Markdown file. From this point on, I have to treat the Markdown file in my Jekyll directory as the canonical note.</p>

<h2 id="exporting-markdown">Exporting Markdown</h2>
<p>When an idea is solid enough to become a piece of content, I export the Bear note to a Markdown file in my Git repo.</p>

<h2 id="jekyll-configuration">Jekyll configuration</h2>
<p>I set up the Jekyll <code class="highlighter-rouge">_config.yml</code> file to support publishing to GitHub Pages. I can’t control the Markdown-to-HTML conversion in this process, so it just needs to work by default. So I set up the URL variables like so:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>url: “https://andrewsleigh.github.io” # the base hostname &amp; protocol for your site
baseurl: “/digital-fabrication-module” # the subpath of your site
</code></pre></div></div>

<p>Jekyll can support multiple config files, so I created a second one, detailed below, to override these settings when publishing to my own site.</p>

<h2 id="jekyll-build-and-serve-variants">Jekyll build and serve variants</h2>
<p>Make sure we’re in the right directory first!
<code class="highlighter-rouge">cd /Users/Andrew/Documents/GitHub/digital-fabrication-module</code></p>

<p>Update: I decided to move the non-code content to a /docs folder, so I’m now serving Jekyll locally from <code class="highlighter-rouge">/Users/andrew/Documents/GitHub/digital-fabrication-module/docs</code></p>

<p>Then, depending on what I’m trying to do, I can use different versions of the Jekyll command to generate the site:</p>

<h3 id="pushing-to-the-remote-repo-on-github-and-publishing-to-github-pages">Pushing to the remote repo on GitHub and publishing to GitHub Pages</h3>
<p>No Jekyll build needed as I’m pushing Markdown files to GitHub, not HTML!</p>

<h3 id="serving-the-site-for-local-testing">Serving the site for local testing</h3>
<p><code class="highlighter-rouge">bundle exec jekyll serve --baseurl ''</code>
This generates the static HTML files indie a <code class="highlighter-rouge">_site/</code> directory, which is then served from <a href="http://127.0.0.1:4000">http://127.0.0.1:4000</a>
This also auto-regenerates the site with every change.</p>

<h3 id="building-the-site-for-deploying-to-my-live-server">Building the site for deploying to my live server</h3>
<p><code class="highlighter-rouge">jekyll build --destination _site-ascom/ --config _config.yml,_config-ascom.yml</code></p>

<p>This builds the site (without auto-regeneration) to a folder, <code class="highlighter-rouge">_site-ascom/</code> and it uses the <code class="highlighter-rouge">--config</code> option to read from two configuration files. The first is the main <code class="highlighter-rouge">_config.yml</code> file which has all the basic options set for the site, including <code class="highlighter-rouge">url</code> and <code class="highlighter-rouge">baseurl</code> as mentioned above.</p>

<p>The second has only two lines, and overrides these settings with ones appropriate for hosting on my site:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>url: "https://andrewsleigh.com"   
baseurl: "/learning/digital-fabrication-module"
</code></pre></div></div>

<h2 id="filepaths">Filepaths</h2>
<p>In general, Jekyll is set up to use relative file paths, and these work fine, so long as the site is built or served using the appropriate options as above.</p>

<h2 id="image-paths">Image paths</h2>
<p>This is how I include an image in a Markdown file. (<code class="highlighter-rouge">assets/</code> is a directory at the root level of my Jekyll site.)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>![laser-printer-driver-dialog.jpg](/assets/laser-printer-driver-dialog.jpg)
</code></pre></div></div>

<p>On GitHub Pages, this renders as:
<code class="highlighter-rouge">&lt;img src="/digital-fabrication-module/assets/laser-printer-driver-dialog.jpg" alt="laser-printer-driver-dialog.jpg" /&gt;</code></p>

<p>On my localhost, when serving with <code class="highlighter-rouge">baseurl ‘’</code>, it renders as:
<code class="highlighter-rouge">&lt;img src=“/assets/laser-printer-driver-dialog.jpg” alt=“laser-printer-driver-dialog.jpg” /&gt;</code></p>

<p>On my live site, when building with <code class="highlighter-rouge">--config _config.yml,_config-ascom.yml</code>:
<code class="highlighter-rouge">&lt;img src="/learning/digital-fabrication-module/assets/laser-printer-driver-dialog.jpg" alt="laser-printer-driver-dialog.jpg" /&gt;</code></p>

<h2 id="publishing-and-version-control">Publishing and version control</h2>
<p>This Jekyll directory is a Git repo on my own development machine. Jekyll can build the site and serve it locally from  <a href="http://127.0.0.1:4000">http://127.0.0.1:4000</a>. I can also publish it to my three public destinations:</p>

<h3 id="1-github">1. GitHub</h3>
<p><a href="https://github.com/andrewsleigh/digital-fabrication-module">https://github.com/andrewsleigh/digital-fabrication-module</a>
This is the home for Markdown files and other assets I would like others to contribute to or adapt themselves.
I can just push changes to the GitHub repo to share them publicly.</p>

<h4 id="a-note-on-gitignore">A note on Gitignore</h4>

<p>The local repo has two folders of static HTML files that don’t need to be synced with GitHub (or indeed controlled with Git locally). So I created a <code class="highlighter-rouge">.gitignore</code> file at the root of this repo to exclude these two folders from Git:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/_site/
/_site-ascom/
</code></pre></div></div>

<p>Actually removing them from the Git repo is a bit more fiddly, since they had already been included in previous commits. <a href="https://stackoverflow.com/questions/7927230/remove-directory-from-remote-repository-after-adding-them-to-gitignore">StackOverflow to the rescue</a>:</p>

<blockquote>
  <p>The rules in your .gitignore file only apply to untracked files. Since the files under that directory were already committed in your repository, you have to unstage them, create a commit, and push that to GitHub:</p>
  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rm -r --cached some-directory  
git commit -m ‘Remove the now ignored directory “some-directory”’  
git push origin master  
</code></pre></div>  </div>
</blockquote>

<p>In my case:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rm -r --cached _site-ascom
git commit -m 'Remove the now ignored directory "_site-ascom"'
git push origin master

git rm -r --cached _site
git commit -m 'Remove the now ignored directory "_site"'
git push origin master
</code></pre></div></div>

<p>This worked, so I added a few more entries to hide some other superfluous files from the public repo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/Gemfile
/Gemfile.lock
**/.DS_Store
/.sass-cache
</code></pre></div></div>

<p><code class="highlighter-rouge">**/.DS_Store</code> should match macOS’s <code class="highlighter-rouge">.DS_Store</code> files whichever directory they’re in.</p>

<p>And then I followed the same procedure to remove these already-committed files from the repo.</p>

<h3 id="2-github-pages">2. GitHub Pages</h3>

<p><a href="https://andrewsleigh.github.io/digital-fabrication-module">https://andrewsleigh.github.io/digital-fabrication-module</a></p>

<p>I use the <a href="https://pages.github.com">built-in GitHub Pages tool</a> to publish these Markdown files to a normal HTML website, also using Jekyll. You can do this without setting your repo as a Jekyll instance, but as I want to create an HTML site myself anyway, <a href="https://help.github.com/articles/using-jekyll-as-a-static-site-generator-with-github-pages/">this is a lot easier</a>, and I can control the design of the site using the same config settings and templates.</p>

<p>‘Publishing’ is automatic once setup, and changes are regenerated on the live GitHub Pages site after every push to the GitHub repo.</p>

<h3 id="3-my-own-site">3. My own site</h3>

<p><a href="https://andrewsleigh.com/learning/digital-fabrication-module/">https://andrewsleigh.com/learning/digital-fabrication-module/</a></p>

<p>I want to maintain a copy of the site at a  URL I control. I don’t have any syncing tools set up with my web host, so periodically, I just use SFTP to sync the <code class="highlighter-rouge">/_site-ascom</code> directory with the <code class="highlighter-rouge">/learning/digital-fabrication-module/</code> directory on my site.</p>


  </div><a class="u-url" href="/colophon/publishing-to-multiple-servers.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Digital Fabrication Module</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Digital Fabrication Module</li><li><a class="u-email" href="mailto:andrew.sleigh@gmail.com">andrew.sleigh@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/andrewsleigh"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">andrewsleigh</span></a></li><li><a href="https://www.twitter.com/andrewsleigh"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">andrewsleigh</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Work-in-progress and draft course notes for a module in digital fabrication at University of Brighton, based on Fab Academy</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
